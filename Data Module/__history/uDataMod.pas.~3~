unit uDataMod;

interface

uses
  System.SysUtils, System.Classes, FireDAC.Stan.Intf, FireDAC.Stan.Option,
  FireDAC.Stan.Param, FireDAC.Stan.Error, FireDAC.DatS, FireDAC.Phys.Intf,
  FireDAC.DApt.Intf, FireDAC.Stan.StorageBin, Data.DB, FireDAC.Comp.DataSet,
  FireDAC.Comp.Client, FireDAC.Stan.StorageJSON, FireDAC.Stan.StorageXML,
  FireDAC.Stan.ExprFuncs, FireDAC.Phys.SQLiteDef, FireDAC.UI.Intf,
  FireDAC.Stan.Def, FireDAC.Stan.Pool, FireDAC.Stan.Async, FireDAC.Phys,
  FireDAC.Phys.SQLite, FireDAC.VCLUI.Wait, FireDAC.DApt, System.Variants,
  FireDAC.Phys.SQLiteVDataSet, FireDAC.Comp.BatchMove.Text, System.IOUtils,
  FireDAC.Comp.BatchMove, FireDAC.Comp.BatchMove.DataSet, System.StrUtils,
  FireDAC.Phys.SQLiteWrapper.Stat;

type
  TDM = class(TDataModule)
    conSGLGB: TFDConnection;
    procedure FDLeadsQueryNewAfterScroll(DataSet: TDataSet);
    procedure LeadsFDTableAfterScroll(DataSet: TDataSet);
  private
    { Private declarations }
  public
    { Public declarations }
    procedure InitializeTable(ATable: TFDTable; AMemTable: TFDMemTable);
    procedure InitializeDatabase;
    procedure CompleteProposal(ALeadId: Integer);
    procedure SetUserQuery(const AUsername: string; AQuery: TFDQuery);
    procedure UpdateProposalStatus(ALeadId: Integer; const AStatus: string);
    procedure ExportEmails(const AFilename: String);
    procedure SearchQuery(const ASQL: String; AQuery: TFDQuery);
    procedure SearchAccounts(const ASearch: String);
    procedure SearchLeadsSubQuery(const ASearch: string; AQuery: TFDQuery);
    procedure SearchLeads(const ASearch: String);
    procedure SearchProposals(const ASearch: string);
    procedure SearchEmails(const ASearch: string);
    procedure SetUser(const AUsername: String);
 end;
  const
    DB_FILENAME = 'w10crmdemo.sdb';
    DB_PASSWORD = 'SecretPassword';
    DB_ENCRYPTION = 'aes-256';
    DB_LEADSTABLE = 'Leads';
    DB_ACCTSTABLE = 'Accounts';
    DB_USERSTABLE = 'Users';
    DB_DOCSTABLE = 'Docs';
    DB_PROPOSALSTABLE = 'Proposals';

var
  DM: TDM;

implementation

{%CLASSGROUP 'Vcl.Controls.TControl'}
{$R *.dfm}

procedure TDM.InitializeTable(ATable: TFDTable; AMemTable: TFDMemTable);
begin
//  ATable.FieldDefs.Clear;
//  ATable.FieldDefs.Assign(AMemTable.FieldDefs);
//  ATable.CreateTable(False);
//  ATable.CopyDataSet(AMemTable, [coStructure, coRestart, coAppend]);
end;

end.
